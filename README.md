# gin-criu

## 注意事项

- gin-criu运行liunx内核的系统
- 应用场景：
- 部署在k8s云上，可以实现多个pod之间的
- 同一个镜像启动多个容器，快照进程容器内的进程通过NFS共享到其他容器内，需要保证容器内的内核环境都是一致的。

## 冻结进程

- 根据进程ID和.IMG文件存储地址，对进程信息进行转储
- 通过设置参数tcpClose=ture 冻结时关闭已建立的tcp连接
- 冻结时通过参数leaveRunning=true在进程不被关闭的情况下获取进程信息转储.IMG文件
- 冻结时通过参数leaveRunning=false获取进程信息转储.IMG文件的同时也会把当前进程killed
- 冻结进程时如果进程通过criu-ns脚本恢复的会存在同一个命名空间内找不到Pid，程序会自动执行criu-ns dump脚本进行冻结

## 恢复冻结程序

- 通过NFS在多个Docker容器内共享.IMG进程信息文件
- 根据.IMG文件地址恢复已被冻结的程序，恢复成功后通过命令ps -vax 查看被恢复的进程
- 程序默认是开启失败自动执行criu-ns脚本，恢复时会存在Pid冲突问题，失败后执行criu-ns脚本，生成新的命名空间在此命名空间内通过进程信息恢复进程
- 通过设置参数rstSibling=true将根任务还原为同级任务通过命令kill执行能够杀死进程
- 通过设置参数rstSibling=false不会将根任务还原为同级任务通过命令kill杀死不了而且还会进入守护进程（僵尸进程）
- criu守护进程（僵尸进程）的问题（守护进程出现的原因是criu尝试恢复失败或者criu恢复的程序出现异常）
- 当前容器环境和被冻结程序的容器环境相同